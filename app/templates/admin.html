<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AutoSuite Admin — ICHKOV</title>

<style>
:root{
  --bg:#0b1220;
  --panel:rgba(255,255,255,0.06);
  --stroke:rgba(255,255,255,0.12);
  --text:rgba(255,255,255,0.95);
  --muted:rgba(255,255,255,0.65);
  --primary:#6ee7ff;
  --accent:#7c3aed;
  --good:#22c55e;
  --warn:#f59e0b;
  --bad:#ef4444;
  --radius:16px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  color:var(--text);
  background:
    radial-gradient(900px 600px at 15% 10%, rgba(124,58,237,.25), transparent 60%),
    radial-gradient(700px 500px at 80% 0%, rgba(110,231,255,.20), transparent 55%),
    var(--bg);
}
.wrap{max-width:1200px;margin:auto;padding:28px}
.topbar{
  display:flex;justify-content:space-between;align-items:center;margin-bottom:20px
}
.brand{display:flex;gap:14px;align-items:center}
.logo{
  width:44px;height:44px;border-radius:14px;
  background:linear-gradient(135deg,#6ee7ff,#7c3aed)
}
.brand b{font-size:18px}
.sub{font-size:12px;color:var(--muted)}
.btn{
  border:1px solid var(--stroke);
  background:rgba(255,255,255,.08);
  color:var(--text);
  padding:10px 14px;border-radius:12px;
  cursor:pointer;font-weight:600
}
.btn.primary{background:linear-gradient(135deg,#6ee7ff,#7c3aed);border:none}
.btn.good{background:rgba(34,197,94,.15)}
.btn.bad{background:rgba(239,68,68,.18)}
.card{
  background:var(--panel);
  border:1px solid var(--stroke);
  border-radius:var(--radius);
  padding:16px;
  margin-bottom:16px
}
h3{margin:0 0 10px 0}
label{font-size:13px;color:var(--muted)}
input,select{
  width:100%;padding:10px;border-radius:10px;
  border:1px solid var(--stroke);
  background:rgba(0,0,0,.25);
  color:white
}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.actions{text-align:right;margin-top:10px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.08);font-size:13px}
th{color:var(--muted);text-align:left}
code{background:rgba(255,255,255,.08);padding:4px 6px;border-radius:8px}
.tabs{display:flex;gap:8px;margin-bottom:10px}
.tab{
  padding:8px 12px;border-radius:10px;
  border:1px solid var(--stroke);
  cursor:pointer;color:var(--muted)
}
.tab.active{background:rgba(110,231,255,.18);color:white}
.toast{
  position:fixed;bottom:20px;right:20px;z-index:9999
}
.toast div{
  background:rgba(0,0,0,.8);
  padding:12px 16px;border-radius:12px;
  margin-top:10px
}
</style>
</head>

<body>
<div class="wrap">

<div class="topbar">
  <div class="brand">
    <div class="logo"></div>
    <div>
      <b>AutoSuite Admin</b>
      <div class="sub">Remote licensing system — ICHKOV</div>
    </div>
  </div>
  <button class="btn" onclick="copy(location.href)">Copy Admin Link</button>
</div>

<!-- CREATE VERSION -->
<div class="card">
<h3>Create Script Version</h3>
<form method="post" action="/admin/version/create?token={{ request.query_params.get('token','') }}">
<div class="row">
  <label>Version
    <input name="version" required placeholder="3.2.0">
  </label>
  <label>Channel
    <select name="channel">
      <option value="stable">stable</option>
      <option value="beta">beta</option>
    </select>
  </label>
</div>
<label>Notes
  <input name="notes" placeholder="Initial release">
</label>
<div class="actions">
  <button class="btn primary">Create Version</button>
</div>
</form>
</div>

<!-- CREATE COMPANY -->
<div class="card">
<h3>Create Company</h3>
<form method="post" action="/admin/company/create?token={{ request.query_params.get('token','') }}">
<label>Company name
  <input name="name" required>
</label>
<label>Allowed domain
  <input name="allowed_domain" placeholder="my.munja-trans.at">
</label>
<div class="actions">
  <button class="btn primary">Create Company</button>
</div>
</form>
</div>

<!-- CREATE LICENSE -->
<div class="card">
<h3>Create License</h3>
<form method="post" action="/admin/license/create?token={{ request.query_params.get('token','') }}">
<div class="row">
<label>Company ID
  <input name="company_id" required>
</label>
<label>Days
  <input name="days" value="30">
</label>
</div>
<label>Max devices
  <input name="max_devices" value="2">
</label>
<div class="actions">
  <button class="btn primary">Create License</button>
</div>
</form>
</div>

<!-- TABLES -->
<div class="card">
<div class="tabs">
  <div class="tab active" onclick="showTab('companies')">Companies</div>
  <div class="tab" onclick="showTab('licenses')">Licenses</div>
  <div class="tab" onclick="showTab('versions')">Versions</div>
</div>

<!-- COMPANIES -->
<div id="companies">
<table>
<thead><tr><th>ID</th><th>Name</th><th>Domain</th><th>Channel</th></tr></thead>
<tbody>
{% for c in companies %}
<tr>
<td><code>{{ c.id }}</code></td>
<td>{{ c.name }}</td>
<td>{{ c.allowed_domain or "-" }}</td>
<td>{{ c.channel }}</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>

<!-- LICENSES -->
<div id="licenses" style="display:none">
<table>
<thead>
<tr>
<th>ID</th><th>Company</th><th>Key</th><th>Active</th><th>Expires</th><th>Actions</th>
</tr>
</thead>
<tbody>
{% for l in licenses %}
<tr>
<td><code>{{ l.id }}</code></td>
<td><code>{{ l.company_id }}</code></td>
<td><code>{{ l.license_key }}</code></td>
<td>{{ 'YES' if l.active else 'NO' }}</td>
<td>{{ l.expires_at }}</td>
<td>
<button class="btn good" onclick="extend('{{l.license_key}}',30)">+30</button>
<button class="btn good" onclick="extend('{{l.license_key}}',90)">+90</button>
<button class="btn good" onclick="extend('{{l.license_key}}',180)">+180</button>
<button class="btn good" onclick="extend('{{l.license_key}}',365)">+365</button>
<button class="btn bad" onclick="block('{{l.license_key}}')">Block</button>
</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>

<!-- VERSIONS -->
<div id="versions" style="display:none">
<table>
<thead><tr><th>ID</th><th>Version</th><th>Channel</th><th>Notes</th></tr></thead>
<tbody>
{% for v in versions %}
<tr>
<td><code>{{ v.id }}</code></td>
<td>{{ v.version }}</td>
<td>{{ v.channel }}</td>
<td>{{ v.notes or '-' }}</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>

</div>

</div>

<div class="toast" id="toast"></div>

<script>
function showTab(t){
  ['companies','licenses','versions'].forEach(x=>{
    document.getElementById(x).style.display = (x===t?'block':'none');
  });
  document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
}
function toast(msg){
  const t=document.createElement('div');
  t.textContent=msg;
  document.getElementById('toast').appendChild(t);
  setTimeout(()=>t.remove(),3000);
}
async function extend(key,days){
  if(!confirm(`Extend ${days} days?`))return;
  await fetch(`/admin/license/extend?token={{ request.query_params.get('token','') }}`,{
    method:'POST',
    headers:{'Content-Type':'application/x-www-form-urlencoded'},
    body:`license_key=${encodeURIComponent(key)}&days=${days}`
  });
  toast('Extended');
  setTimeout(()=>location.reload(),800);
}
async function block(key){
  if(!confirm('Block license?'))return;
  await fetch(`/admin/license/block?token={{ request.query_params.get('token','') }}`,{
    method:'POST',
    headers:{'Content-Type':'application/x-www-form-urlencoded'},
    body:`license_key=${encodeURIComponent(key)}`
  });
  toast('Blocked');
  setTimeout(()=>location.reload(),800);
}
</script>

</body>
</html>
